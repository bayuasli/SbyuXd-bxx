{
  "628895307489": [
    {
      "role": "user",
      "content": "### Plugin Structure\n\nEach plugin must follow this standard structure:\n\n```javascript\n/** @type {import('#lib/types.js').Plugin} */\nexport default {\n name: \"name\", // Plugin name (required)\n category: \"category\", // Plugin category (required)\n command: [\"command1\", \"command2\"], // Command list (required)\n alias: [\"cmd1\", \"cmd2\"], // Command aliases (optional)\n \n // Plugin configuration (optional)\n settings: {\n owner: true, // Owner-only feature\n private: false, // Private chat only\n group: true, // Group chat only\n admin: false, // Group admin only\n botAdmin: true, // Bot must be admin\n loading: false // Send loading message\n },\n\n // Main function called when command is executed (required)\n run: async (conn, m, context) => {\n const { Api, Func, downloadM, quoted, metadata, isOwner, isAdmin, isBotAdmin } = context;\n // Implementation code here\n },\n\n // Function called on every incoming message (optional)\n on: async (conn, m, context) => {\n // Implementation code here\n }\n};\n```\n\n### Context Parameters\n\n| Parameter | Description |\n|-----------|-------------|\n| `Api` | Wrapper for API-related functions (see `lib/api.js`) |\n| `Func` | Collection of utility functions (see `lib/function.js`) |\n| `downloadM` | Function to download media from messages |\n| `quoted` | Replied message object |\n| `metadata` | Group chat metadata |\n| `isOwner` | Boolean indicating if sender is owner |\n| `isAdmin` | Boolean indicating if sender is group admin |\n| `isBotAdmin` | Boolean indicating if bot is group admin |\n\n### Autocomplete (JSDoc)\n\nFor autocomplete and type checking, add JSDoc above `export default`:\n\n```javascript\n/** @type {import('#lib/types.js').Plugin} */\nexport default {\n // ... plugin code\n};\n```\n\n---\n\n## Directory Structure\n\n```\nESEMPE-MD/\n‚îú‚îÄ‚îÄ lib/\n‚îÇ ‚îú‚îÄ‚îÄ api.js # API wrapper functions\n‚îÇ ‚îú‚îÄ‚îÄ color.js # Console color utilities\n‚îÇ ‚îú‚îÄ‚îÄ exif.js # EXIF metadata handler\n‚îÇ ‚îú‚îÄ‚îÄ function.js # General utility functions\n‚îÇ ‚îú‚îÄ‚îÄ loadPlugins.js # Plugin loader system\n‚îÇ ‚îú‚îÄ‚îÄ serialize.js # Message serialization\n‚îÇ ‚îî‚îÄ‚îÄ types.js # TypeScript definitions\n‚îú‚îÄ‚îÄ plugins/\n‚îÇ ‚îú‚îÄ‚îÄ downloader/ # Download plugins\n‚îÇ ‚îú‚îÄ‚îÄ tools/ # Tool plugins\n‚îÇ ‚îî‚îÄ‚îÄ utility/ # Utility plugins\n‚îú‚îÄ‚îÄ config.js # Configuration file\n‚îú‚îÄ‚îÄ handler.js # Message handler\n‚îú‚îÄ‚îÄ index.js # Entry point\n‚îî‚îÄ‚îÄ package.json # Package configuration\n```\n\nitu struktur plugins saya\n\nda\n dibawa ini hadler.js saya\nimport axios from 'axios'\nimport { jidNormalizedUser } from 'baileys'\nimport util from 'util'\nimport cp from 'child_process'\nimport Api from '#lib/api.js'\nimport Func from '#lib/function.js'\n\n/* ================= SYSTEM CORE ================= */\n\nconst MSG_QUEUE = []\nlet PROCESSING = false\nconst RATE = new Map()\n\nfunction queuePush(job) {\n MSG_QUEUE.push(job)\n runQueue()\n}\n\nasync function runQueue() {\n if (PROCESSING || !MSG_QUEUE.length) return\n PROCESSING = true\n const job = MSG_QUEUE.shift()\n try { await job() } catch (e) { console.error(e) }\n PROCESSING = false\n runQueue()\n}\n\nfunction isLimited(id, delay = 1200) {\n if (RATE.has(id)) return true\n RATE.set(id, 1)\n setTimeout(() => RATE.delete(id), delay)\n return false\n}\n\nsetInterval(() => {\n if (global.gc) global.gc()\n}, 300000)\n\n/* ================= HANDLER ================= */\n\nasync function core(conn, m) {\n if (m.isBot) return\n if (isLimited(m.sender)) return\n if (!IS_PUBLIC && !m.fromMe && !ownerNumber.includes(m.sender.split('@')[0])) return\n\n const quoted = m.isQuoted ? m.quoted : m\n const downloadM = async (filename) => await conn.downloadMediaMessage(quoted, filename)\n const isCommand = (m.prefix && m.body.startsWith(m.prefix)) || false\n const isOwner = m.fromMe || ownerNumber.includes(m.sender.split('@')[0])\n\n const metadata = m.isGroup ? conn.chats[m.chat] || (await conn.groupMetadata(m.chat).catch(() => null)) : {}\n const Admin = m.isGroup && metadata.participants?.find(u => conn.getJid(u.id) === m.sender)\n const isAdmin = Admin?.admin === 'superadmin' || Admin?.admin === 'admin' || false\n const isBotAdmin = m.isGroup && metadata.participants?.find(u => conn.getJid(u.id) === jidNormalizedUser(conn.user.id))?.admin || false\n\n const ctx = { Api, Func, downloadM, quoted, metadata, isOwner, isAdmin, isBotAdmin }\n\n for (const plugin of Object.values(plugins)) {\n\n if (typeof plugin.on === 'function') {\n try {\n const handled = await plugin.on.call(conn, m, ctx)\n if (handled) continue\n } catch (e) {\n console.error(`[PLUGIN EVENT ERROR] ${plugin.name}`, e)\n }\n }\n\n if (isCommand) {\n const command = m.command?.toLowerCase()\n const isCmd = plugin?.command?.includes(command) || plugin?.alias?.includes(command)\n\n if (!isCmd) continue\n\n try {\n if (plugin.settings?.owner && !isOwner) return m.reply(mess.owner)\n if (plugin.settings?.private && m.isGroup) return m.reply(mess.private)\n if (plugin.settings?.group && !m.isGroup) return m.reply(mess.group)\n if (plugin.settings?.admin && !isAdmin) return m.reply(mess.admin)\n if (plugin.settings?.botAdmin && !isBotAdmin) return m.reply(mess.botAdmin)\n if (plugin.settings?.loading) m.reply(mess.wait)\n\n await plugin.run(conn, m, ctx)\n\n } catch (e) {\n console.error(`[PLUGIN ERROR] ${plugin.name}`, e)\n await m.reply('Terjadi error saat menjalankan command.')\n }\n }\n }\n\n if (['>', '=>'].some(a => m.body?.toLowerCase().startsWith(a)) && isOwner) {\n let evalCmd = ''\n try {\n evalCmd = /await/i.test(m.text)\n ? eval(`(async() => { ${m.text} })()`)\n : eval(m.text)\n } catch (e) { evalCmd = e }\n\n Promise.resolve(evalCmd)\n .then(res => m.reply(util.format(res)))\n .catch(err => m.reply(util.format(err)))\n }\n\n if (m.body?.startsWith('$') && isOwner) {\n const exec = util.promisify(cp.exec).bind(cp)\n let o\n try { o = await exec(m.text) } catch (e) { o = e }\n const { stdout, stderr } = o\n if (stdout?.trim()) m.reply(stdout)\n if (stderr?.trim()) m.reply(stderr)\n }\n}\n\n/* ============== EXPORT WRAPPED QUEUE ============== */\n\nexport default function handler(conn, m) {\n queuePush(() => core(conn, m))\n}\nnantinya saya akan menyuruh anda untuk mengubah code tertentu ke style plugins saya",
      "timestamp": 1770304805359
    },
    {
      "role": "assistant",
      "content": "Baik, saya siap membantu mengubah kode tertentu ke dalam style plugin sesuai struktur dan gaya kode yang Anda gunakan. Silakan berikan kode yang ingin diubah atau instruksi spesifiknya.",
      "timestamp": 1770304805360
    },
    {
      "role": "user",
      "content": "case 'hd': {\n\n const axios = require('axios')\n const FormData = require('form-data')\n const fs = require('fs')\n\n const qMsg = m.quoted || m\n const mimeLocal = (qMsg.msg || qMsg).mimetype || ''\n\n if (!/image/.test(mimeLocal)) {\n return client.sendMessage(m.chat, {\n text: `‚ùå Kirim atau reply gambar dengan caption *${prefix + command}*`\n }, { quoted: fquoted.packSticker })\n }\n\n await client.sendMessage(m.chat, {\n text: 'üîÑ Proses HD gambar, mohon tunggu...'\n }, { quoted: fquoted.packSticker })\n\n try {\n const mediaPath = await client.downloadAndSaveMediaMessage(qMsg)\n const buffer = fs.readFileSync(mediaPath)\n\n const form = new FormData()\n form.append('method', '1')\n form.append('is_pro_version', 'false')\n form.append('is_enhancing_more', 'false')\n form.append('max_image_size', 'high')\n form.append('file', buffer, `enhance_${Date.now()}.jpg`)\n\n const { data } = await axios.post('https://ihancer.com/api/enhance', form, {\n headers: {\n ...form.getHeaders(),\n 'accept-encoding': 'gzip',\n host: 'ihancer.com',\n 'user-agent': 'Dart/3.5 (dart:io)'\n },\n responseType: 'arraybuffer'\n })\n\n await client.sendMessage(m.chat, {\n image: Buffer.from(data),\n caption: '‚úÖ Gambar berhasil di-HD'\n }, { quoted: fquoted.packSticker })\n\n fs.unlinkSync(mediaPath)\n } catch (e) {\n console.error(e)\n await client.sendMessage(m.chat, {\n text: '‚ùå Terjadi kesalahan saat memproses gambar.'\n }, { quoted: fquoted.packSticker })\n }\n}\nbreak\n\nubah case ini menjadi plugin style sc bot saya",
      "timestamp": 1770304848574
    },
    {
      "role": "assistant",
      "content": "/** @type {import('#lib/types.js').Plugin} */\nexport default {\n  name: \"hd_image_enhance\",\n  category: \"tools\",\n  command: [\"hd\"],\n  alias: [],\n  settings: {\n    owner: false,\n    private: false,\n    group: false,\n    admin: false,\n    botAdmin: false,\n    loading: false,\n  },\n  run: async (conn, m, { Api, Func, downloadM, quoted, metadata, isOwner, isAdmin, isBotAdmin }) => {\n    const { axios, FormData, fs } = Api\n    const client = conn\n    const prefix = '' // Sesuaikan jika perlu\n    const command = 'hd'\n    const fquoted = { packSticker: true } // Sesuaikan jika ada\n\n    // Mendapatkan pesan yang direply atau pesan saat ini\n    const qMsg = m.quoted || m\n    const mimeLocal = (qMsg.msg || qMsg).mimetype || ''\n\n    // Validasi tipe media\n    if (!/image/.test(mimeLocal)) {\n      return await client.sendMessage(m.chat, {\n        text: `‚ùå Kirim atau reply gambar dengan caption *${prefix + command}*`\n      }, { quoted: fquoted.packSticker })\n    }\n\n    // Kirim pesan proses\n    await client.sendMessage(m.chat, {\n      text: 'üîÑ Proses HD gambar, mohon tunggu...'\n    }, { quoted: fquoted.packSticker })\n\n    try {\n      // Download media dari pesan\n      const mediaPath = await downloadM(qMsg)\n      const buffer = await Func.readFileAsync(mediaPath)\n\n      // Membuat form data\n      const form = new FormData()\n      form.append('method', '1')\n      form.append('is_pro_version', 'false')\n      form.append('is_enhancing_more', 'false')\n      form.append('max_image_size', 'high')\n      form.append('file', buffer, `enhance_${Date.now()}.jpg`)\n\n      // Mengirim request ke API enhancer\n      const { data } = await axios.post('https://ihancer.com/api/enhance', form, {\n        headers: {\n          ...form.getHeaders(),\n          'accept-encoding': 'gzip',\n          host: 'ihancer.com',\n          'user-agent': 'Dart/3.5 (dart:io)'\n        },\n        responseType: 'arraybuffer'\n      })\n\n      // Mengirim gambar hasil HD\n      await client.sendMessage(m.chat, {\n        image: Buffer.from(data),\n        caption: '‚úÖ Gambar berhasil di-HD'\n      }, { quoted: { packSticker: true } })\n\n      // Hapus file sementara\n      fs.unlinkSync(mediaPath)\n    } catch (e) {\n      console.error(e)\n      await client.sendMessage(m.chat, {\n        text: '‚ùå Terjadi kesalahan saat memproses gambar.'\n      }, { quoted: { packSticker: true } })\n    }\n  }\n}",
      "timestamp": 1770304848574
    }
  ]
}